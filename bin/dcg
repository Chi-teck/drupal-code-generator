#!/usr/bin/env php
<?php

use DrupalCodeGenerator\Application;
use DrupalCodeGenerator\Command\Navigation;
use DrupalCodeGenerator\GeneratorDiscovery;
use DrupalCodeGenerator\Utils;
use Symfony\Component\Filesystem\Filesystem;

// The autoloader may have a different location if DCG is installed as a local
// Composer package.
$autoloader = file_exists(__DIR__ . '/../vendor/autoload.php')
  ? require __DIR__ . '/../vendor/autoload.php'
  : require __DIR__ . '/../../../autoload.php';

// Create an application.
$application = Application::create();

// Discover generators.
$discovery = new GeneratorDiscovery(new Filesystem());
$default_generators = $discovery->getGenerators([Application::getRoot() . '/src/Command']);
$custom_generators = [];

$command_directory = getenv('DCG_COMMAND_DIRECTORY') ?: Utils::getHomeDirectory() . '/.dcg';
if (is_dir($command_directory)) {
  $autoloader->addPsr4('DrupalCodeGenerator\\', $command_directory);
  $custom_generators = $discovery->getGenerators([$command_directory], '\DrupalCodeGenerator');
}

$generators = array_merge($default_generators, $custom_generators);
$application->addCommands($generators);

// Add the navigation command.
$application->add(new Navigation($generators));
$application->setDefaultCommand('navigation');

// Run.
$application->run();

$q = [];
each($q);
