#!/usr/bin/env php
<?php

$autoloader = require __DIR__ . '/../vendor/autoload.php';

use DrupalCodeGenerator\GeneratorsDiscovery;
use DrupalCodeGenerator\Commands;
use Symfony\Component\Console\Application;
use Symfony\Component\Filesystem\Filesystem;


$commands_directories = [DCG_ROOT . '/src/Commands'];

// Allow custom commands.
if (file_exists(DCG_HOME . '/Commands')) {
  $commands_directories[] = DCG_HOME . '/Commands';
  $autoloader->addPsr4('DrupalCodeGenerator\\', DCG_HOME);
}

$filesystem = new Filesystem();
$twig_loader = new Twig_Loader_Filesystem(DCG_ROOT . '/src/Resources/templates');
$twig = new Twig_Environment($twig_loader);

$discovery = new GeneratorsDiscovery($commands_directories, $filesystem, $twig);
$generators = $discovery->getGenerators();

$application = new Application('Drupal Code Generator', '@git-version@');
$application->addCommands($generators);

$navigation = new Commands\Navigation();
$navigation->init($generators);
$application->add($navigation);

$application->setDefaultCommand('navigation');
$application->run();
